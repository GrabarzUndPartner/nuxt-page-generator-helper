language: node_js
branches:
  except:
    - /^v\d+\.\d+\.\d+$/
env:
  global:
    # github
    - secure: Fcrj49dqJMAadKtoEKnmYUvzyj96CpiuSWlLF3HnNNbBa0NYUqQFy3H2fbh4+n/sdl/VU0Zu/h1MXaYP6zIYzEVn+0fdiVtnO0YPgBp60jfI0ie65JrCpizLg7lUrDSdC+hJzNt2NEttazrmZJMgMxVsBoxTrFhz6SCz+Yu/h5JplqySSnp49wi81NFI5iSo8YzRa5WuF5qrdVcFvslrOCHZPOm45zEpR8AgGU+W+mQisDXb/w7wWA+kHBla5l+b2YL2rvX1x0HEpSmRoxp31wmcI6fy7eqgjMsva6VCmTL23UJHPlgni6doMQpyEqkLAH+78hbXYPcXYbc7Wwtm8zU+IaQ0JryOzYTdOIWsKRshNTWjssPRIDsq/s1Um51b4pUfVJvzS+FuXF9qrXkEgkIkfV4SYIvDN6TXBYzyGpOts/7dacXJ74QJFJb8EADh9GTYu9ll1ne8V7POnfCeGxMqCYFtrSfUdjoVDD9NEoKJWEdxYn7ep0GM+qK8FT4/DuR9qfTkIbi2tLkGqrlkzcANy3xrBlQlByln+CRVTzq0VjkdJrwucWtSq69wAHrpyw4CqY1qOCmhje4kGTDBvVR/I5qRl2xBHagZZ0931Dr3QQUj/uohsSjSt6S/+embiKF/hiJAfetsOnymFv31myd0jfFF1u7u+r2HXofNEqk=
    # npm
    - secure: rjo3eQkeaqw58aY8n0LBwFclv8gUUJ5fASoU3dqgKfNxHL1p6hs4BlFlh9HeToKdjgTPOdqBlgWyno/4jJfSuhfgfBY9DdUySirz5gm3hm2krGDJFPKuKPtXYT6juPl+3hd2kBdn+iHlp2nVUYC16aEfX+jKhzdpKLHXojDRuW7X6VB36Vk2LqgTZwCLg1vJMFWEEJTWAtVNrUvHz9iC8PO0XwZxB8EUeDS5v6qKOTpqbiM6/mmpUo1yJhXsZ3Djw4htI07K96JZl42FRcmnWbtpIBXNjE8bcXFU/3RxgJr2znsJsIm3/ODLzTdzk3bnfYOh/mnYy+DUq8PNXlYNglqtH3u200x1Dn7NYtisp64gblGr2FTi0Pxj3ycBb6a28M2SaMXyAo8/ugXyHMEvbw5adjqMpHEljTE6yVc+4jxQCaRupWblG4dLPkzvqqRYv8WbUTbwtN3erjUWJVtk/zHcgTLXQK1StEhBH4cG6z0K6fBAPkXpYpCEQXpSlnvGQrxRYtapqpcyE5jT/ynVh+jlld6y6YNER45JV02ulRORggoLSjgm7m7K7dj235elvcOpqDzM3JcZmH0xLf1LzNNDqmTZhDkNakcGCfRF6mk9biLcMO1gIkobe/FHCEgFEPpGFaPsPB3m7k5Ihs41kRVp1jSceuIVSYBO8UkRFmU=
cache:
  npm: true
  directories:
    - dist
    - reports
jobs:
  include:
    - stage: prepare cache
      name: install
      before_install:
        - rm -rf dist reports
      install:
        - npm i
    - stage: website
      name: build
      script:
        # - echo $TRAVIS_PULL_REQUEST_BRANCH
        # - echo $TRAVIS_BRANCH
        # - echo $TRAVIS_COMMIT
        # - echo $TRAVIS_PULL_REQUEST_SHA
        - if [ -z "$TRAVIS_PULL_REQUEST_BRANCH" ]; then export PT_BRANCH=$TRAVIS_BRANCH; else export PT_BRANCH=$TRAVIS_PULL_REQUEST_BRANCH; fi
        - if [ -z "$TRAVIS_PULL_REQUEST_SHA" ]; then export PT_COMMIT=$TRAVIS_COMMIT; else export PT_COMMIT=$TRAVIS_PULL_REQUEST_SHA; fi
        # - echo $PT_COMMIT
        # - echo $PT_BRANCH
        - npm run static --base=/nuxt-page-generator-helper/
    - stage: deploy
      if: branch = master
      install:
        - npm i semantic-release @semantic-release/exec @semantic-release/git @semantic-release/changelog --no-save
      script:
        - npx semantic-release --provider=github
        - mkdir gh-pages gh-pages/reports
        - cp -R dist/* gh-pages/
        - cp -R reports/* gh-pages/reports/
        - touch gh-pages/.nojekyll
      deploy:
        provider: pages
        cleanup: false
        github_token: $GH_TOKEN
        local_dir: gh-pages/
        on:
          branch: master
        edge: true
