language: node_js
branches:
  except:
    - /^v\d+\.\d+\.\d+$/
env:
  global:
    # github
    - secure: Bl3MpWFqAlPy/9gMewSLlmCh+JMpONoMYGiHDPSEPiuD3FDXdaCrUz0zu7sDqiVAVu8TwT+lqifCQCmKzTYUC28XRIz5IyKB9Pg1McDSJd50J2Te+mWmOS5RvYuBtFOMvYeIrT3Q3wMrPnWlfAK1TvSJABylQ9AouzgW1Oj/0fX1fIDfhQQns1Ce4Z9U+fjCwUZSqT9T0gq1cSkA1HB6eQCl2EDgs08uNCD6R7XPPTNKCjH1ask0OsDk31o0BgXNY2XD7eetqBF2AnKFjjHD0zd1for2E9f/Y0Nk29j93MLpxHSFZBqwRdMb8+wZFYqvnW2CJ+U+FuAzyybAA9yPWEVmbp28zHS0Tpy0WrNH2UAa3G9N1XiSvCVFGqyyppgSXP/yu9/7GHXx8c9VrsHvngRnVztkhDZuDx3HnpMKYgn4pyzR2Msy9ZX5GtzZlutvhj+UqJyplcRbki7ujbifdOM68Z0TaJfi9qNzTlwWjZefsABQTtjgnXXu+cYDLHxZPhnVhmwdAY174RONpkhTIn1UnMn07soMrZ4Rjqp20l/MChZSDFx6QUciu1Ra8Rz7CrEuKsxqGPZnTIbAlyOZQRQ4xKzuy/5KVejhTsAqjtURtZROFAgEAwC0dD0nv9DAqnC7NBtA92c5aojAe+JfHYZbKWCFzLur+z2J1UDV2HE=
    # npm
    - secure: S3+AsWieU78FsBw7X6uV8Q6QjeRpM9+SD0EgjUgkHITf2r7T/jfKli2R+/jVrJptZJ/lUAf4WUi9qjg47eADNI7o7G5gmshYcUCzXXW/3j39r2WelauxJwTFZEduDtyzUES7uOgTGxjlbPgRRk5dfsF3p4pKGz9xWBStJlYq2FS/HWjF/QTJCWTz2u79S/JV9QLgVEnGkiYAO3++hGBqLP1r7+Q9rArnC3jr91X9wGMGuCFqdSDCinyazH+dFxRhO7NvDnaFkIld0rLVYSb8qKOqNDNBSIURUi0sggBnM6WPiXbprku13AX0FsAZxitY3y9oHPyzCXyTWlozxTL/QLtb705/5IPA7RwxhX0gOKC9W1dgCr/Cjs+MCkXB8I7tJ01ep4pGXdEB1j2j4FQzgKiHmh3y+XTCHzBdN9w7DrH0gXZXnwUeka2XjA3hCN+vG6gi+OJRmKEZMPjyhtay+/hy/nv7KETuKLx8NKAbws+18BXzwEI3a/RG9qY/OY0TecACNt8ms+NDkYe49qpqk1WZDAPvhgk1+mi9Gxk/uBVcgwz0aacwW9W2qYmhm3zPoaqFBXl7TjwVzAglv+w9BvsyCMZKI2ITCtaYfRVRIHnxWRTka8l6jc0kOKkWU1D4iyxrlJmC3PHD/F5UCGMzQ8nppTyE2EM7Cym+IMWsQEc=
cache:
  npm: true
  directories:
    - dist
    - reports
jobs:
  include:
    - stage: prepare cache
      name: install
      before_install:
        - rm -rf dist reports
      install:
        - npm i
    - stage: website
      name: build
      script:
        # - echo $TRAVIS_PULL_REQUEST_BRANCH
        # - echo $TRAVIS_BRANCH
        # - echo $TRAVIS_COMMIT
        # - echo $TRAVIS_PULL_REQUEST_SHA
        - if [ -z "$TRAVIS_PULL_REQUEST_BRANCH" ]; then export PT_BRANCH=$TRAVIS_BRANCH; else export PT_BRANCH=$TRAVIS_PULL_REQUEST_BRANCH; fi
        - if [ -z "$TRAVIS_PULL_REQUEST_SHA" ]; then export PT_COMMIT=$TRAVIS_COMMIT; else export PT_COMMIT=$TRAVIS_PULL_REQUEST_SHA; fi
        # - echo $PT_COMMIT
        # - echo $PT_BRANCH
        - npm run static --base=/nuxt-page-generator-helper/
    - stage: deploy
      if: branch = master
      install:
        - npm i semantic-release @semantic-release/exec @semantic-release/git @semantic-release/changelog --no-save
      script:
        - npx semantic-release --provider=github
        - mkdir gh-pages gh-pages/reports
        - cp -R dist/* gh-pages/
        - cp -R reports/* gh-pages/reports/
        - touch gh-pages/.nojekyll
      deploy:
        provider: pages
        cleanup: false
        github_token: $GITHUB_TOKEN
        local_dir: gh-pages/
        on:
          branch: master
        edge: true

