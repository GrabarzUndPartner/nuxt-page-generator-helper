language: node_js
branches:
  except:
    - /^v\d+\.\d+\.\d+$/
env:
  global:
    # github
    - secure: M7puCbwuRGzZ/9ea5TTN/W7gFjbEBY4c4JUduNTlcDOywXT6OXbbWeIU12uJgOjre9MM1Pzja0lcuFJcYFSF1y7GvXFDr5X3Xu3qJUeFqb68Cz04rKwN5pnC5Ifz8ASxo6GjtX0U8rvAQdxU7e/DSCwHOQgyC64l3lvjBvuBkOFgK/OQyVBRYb4W+ywW07zFweXmZXVu3chYH0rP76unLigWPHLs2uIGuh21lJJWp42EeCnz8kuCtsCU8KCsx86LZDvtcMvaTtK8oi4yQ7SrSAJ99EgKB24BzcrWOuDeszgs4f0jbxBY+I0M1WK/O/cbkWPaO+WYYZr9S6X/Tv5OVl+WqgTMs3J2WpMeys4bwzGLbqYSf0M2/WVUGZRBvZkN9KcDxDPveOeobaA4ckMpYtWuu8ZdH8Uvto4GddVluwOuwMCGkfdEeTJutF2ZYxDqyWd9s9AXHQSkTbSsK1gTi/eqi8nlnglgmyeaWTma1aoIKdFHJ+GyW81qbR6jLbf5oVv1BQsnR1TgRwvKihws3f8eVz3XS3yKDSOx4w+MaVdOdf9EvtODEXDLCZECOorzzTMJGWv4AGuhdcR0Xe5X0YKOfeOPoHthd1ONiBbW/AU1nrL2ZNlSHFaIeqqjgEbDKqG8xlHz3togBBOyD2z8oGlMTz10DVCSE8FXm34xWek=
    # npm
    - secure: SC8wMBoUjYSoUjLpE/aOCkdTn9UqXwyZOQBqwh/ZKx1ybOwAGhL1NgL74m97wBEdAhGiTZSk9RMVkzbD4e7Nr4navz5lT4kwH3MW8erOJILO6HgngipR9rpgs6pFhE+jfuadfJRq7d8gaTGXxj8GNw50ieYpmHqNt5kozMCCzqY6VWlNFCfzMhn7SlWRG+761zay7LJanORLs/eAFWr/PE4UmHsibRzt1YDgdkpvZEbUcW1zSA4JJfMJyp+0Kct5KyAxrILCBBCuEUmdCH5zhv9NDsca2CzaS1zRgHbQG54IM9MTFk1hqYRxZPbevObWK+bw7ZAuBjm7GetKwcgMhT/r7E2HXcOT+N6+LhXt1AlH/CibBRqT2+b6dMVS26MIoLCZlTwNVgNDolhJHzOgbctn1MzhR7+m6ijrthI9Lf83k+qswyTuG/Qol8eNbyxaZHtu5KWprduR7/5/ido65VcZdmf+mpvx4JHHpinvOFClCXzJh5DbcuH2zsySEefU42vUj4kKIiYraZs+fiLchn2D2Ur6dFIO10NCMVDbE9vcJb9knVXG8bPOKX+dpmPSRyoLP/IUfNKvJdwY6KTRF/4M27GzezVh3LW/HlAYb1z2hc/9MA/jBXdjLpFouF+K9jR+A4SxpOqgIVLhTC6mvqNrt9z0WpqdTxlk6cNO0/k=
cache:
  npm: true
  directories:
    - dist
    - reports
jobs:
  include:
    - stage: prepare cache
      name: install
      before_install:
        - rm -rf dist reports
      install:
        - npm i
    - stage: website
      name: build
      script:
        # - echo $TRAVIS_PULL_REQUEST_BRANCH
        # - echo $TRAVIS_BRANCH
        # - echo $TRAVIS_COMMIT
        # - echo $TRAVIS_PULL_REQUEST_SHA
        - if [ -z "$TRAVIS_PULL_REQUEST_BRANCH" ]; then export PT_BRANCH=$TRAVIS_BRANCH; else export PT_BRANCH=$TRAVIS_PULL_REQUEST_BRANCH; fi
        - if [ -z "$TRAVIS_PULL_REQUEST_SHA" ]; then export PT_COMMIT=$TRAVIS_COMMIT; else export PT_COMMIT=$TRAVIS_PULL_REQUEST_SHA; fi
        # - echo $PT_COMMIT
        # - echo $PT_BRANCH
        - npm run static --base=/nuxt-page-generator-helper/
    - stage: deploy
      if: branch = master
      install:
        - npm i semantic-release @semantic-release/exec @semantic-release/git @semantic-release/changelog --no-save
      script:
        - npx semantic-release --provider=github
        - mkdir gh-pages gh-pages/reports
        - cp -R dist/* gh-pages/
        - cp -R reports/* gh-pages/reports/
        - touch gh-pages/.nojekyll
      deploy:
        provider: pages
        cleanup: false
        github_token: $GH_TOKEN
        local_dir: gh-pages/
        on:
          branch: master
        edge: true


