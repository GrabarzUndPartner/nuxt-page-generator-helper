language: node_js
branches:
  except:
    - /^v\d+\.\d+\.\d+$/
env:
  global:
    # github
    - secure: "wB+wSAH0HHTOxf2osutRYrKyfRolWjkP6UDHJGH8hqb8UNHlz37emQ1RxpUqF6UL3SBurwkFoMulWo+QkthHbTBf6u85XjDB8+9IjOo3o0J7C4kNUhsh6jHKIR08RuFe3tGcPBO1dgsXH4f2mk1fFK78hIUNfAOjREApzUMSA+ZQ1RWNV4jGQoF3tCc2/jrI8IvD53oFBX6FWKNAJH0QcapcLWdjyMxVCv257UMCUuTJWXCUk1TPq5ngFqPuIA7Z+FI8cNy65Wj0F5HYdg5/1DsW06w9u23sEur6DnSGD5SWzzvohtk9Wv93pbpMAPn+GZwfTITziuA/cbxjt9Yh8LWsuXkJkcdoz+mG8iMtJfypml5J4JvRjm1L5STEHkg0i743sh/1LjWja6CRkcbwa2rOeMqKWxp/enCOMe4VWxxnlNMY5wjO56pdky1P937eLSfL5N3h/bj+KiSC926plt2INbS4meY0+C8kYp3mGj4OoH+aHU5Ahdw8S893x4aS7i3T8jeIy5ztsWkJppLHOv2LK6CiLFqlV1262vXr9EHismWJd+ABqbb3Rc6n4Wamo2iXdKW9udrVK8YuYXE1D87QtnSSQXQHCEgze98DZCTk3/V3hZMQUH9HSEAdSRFSQSAPl2aUsB7DwaoxWC1IFTnFOCMD4orL2i2HMdC1enk="
    # npm
    - secure: "mhFKpjPtOcoytTdPyx35UZ9YmEXSon1w9a446ePWoxt8FZ7W+sgzjq/2gk7A/ZzAKN9c5BEUMHGBSJeuXBk4+zkW0KeIwgcMRAMA0Z8eD/ZrLEUbKWhCNpfQmfSuZwNMHaGCv9jvOi3M93PG8VyxdQwO0eUzNJkQtGxpLa9iUBo34SR5nDSn9ZCjkyO4e6jbtfJXwy/1Wuz0ZO8S5GWngLpky7TgzyVM4nn906fptoAI1EZalFKIiWd48hPn0FRKigDt8vVa+CqDZOF+sf3z9ljy7Jz1AghnybPG5oKBIj1fW7QfxTZWpapqKpxWFWDTmfbHz8hKbqD6pOOv/tyuaaFHYSvH/RvidPkGI5T+Ci1QKrpTJ90TFkmHPqcsnGGVS6QUCG0vDaRBwntQ7KSjfknZLGGyNqaoFISL4AOJ9ECylD64/cS8Jzw6O2gf1VOXMwCVeT3SWVWP0anWtdg/ylOhK5SGLP9FfJ7fdIW+AH0/9SxM5GHoS0lf+FotpzDYg8pzUoDCGARqDPichOych0Ic1RL8b1sMSF4ELO96PXmNdCSdDuipYAjJBnLzHt0AlBn4Sr8bY6UTbT2x/kXdotxtNwIOZfJhmIDaavDZPnFI460T2tH314AxWGwx/nPzItsCndSzzLS4+w7lQMLWWa2xUrz2EuqDw68wYTvaZss="
cache:
  npm: true
  directories:
    - dist
    - reports
jobs:
  include:
    - stage: prepare cache
      name: install
      before_install:
        - rm -rf dist reports
      install:
        - npm i
    - stage: website
      name: build
      script:
        # - echo $TRAVIS_PULL_REQUEST_BRANCH
        # - echo $TRAVIS_BRANCH
        # - echo $TRAVIS_COMMIT
        # - echo $TRAVIS_PULL_REQUEST_SHA
        - if [ -z "$TRAVIS_PULL_REQUEST_BRANCH" ]; then export PT_BRANCH=$TRAVIS_BRANCH; else export PT_BRANCH=$TRAVIS_PULL_REQUEST_BRANCH; fi
        - if [ -z "$TRAVIS_PULL_REQUEST_SHA" ]; then export PT_COMMIT=$TRAVIS_COMMIT; else export PT_COMMIT=$TRAVIS_PULL_REQUEST_SHA; fi
        # - echo $PT_COMMIT
        # - echo $PT_BRANCH
        - npm run static --base=/nuxt-page-generator-helper/
    - stage: deploy
      if: branch = master
      install:
        - npm i semantic-release @semantic-release/exec @semantic-release/git @semantic-release/changelog --no-save
      script:
        - npx semantic-release --provider=github
        - mkdir gh-pages gh-pages/reports
        - cp -R dist/* gh-pages/
        - cp -R reports/* gh-pages/reports/
        - touch gh-pages/.nojekyll
      deploy:
        provider: pages
        cleanup: false
        github_token: $GITHUB_TOKEN
        local_dir: gh-pages/
        on:
          branch: master
        edge: true

